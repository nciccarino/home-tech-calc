<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ROI Calculator</title>
	<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

	<script type="text/javascript">
		$(document).ready(function() { 

			function handleDrop() {
				var cat = $("#catSelect").val();
				var typ = $("#typeSelect").val();

				console.log(cat)

				if (cat == 2 || cat == 4) {
					$("#CabBudget").val(30);
					$("#FloorBudget").val(8);
					$("#CounterBudget").val(10);
					$("#AppBudget").val(25);
					$("#LightingBudget").val(8);
					$("#WallBudget").val(3);
					$("#LaborBudget").val(15);
					$("#MiscBudget").val(1);
					if (typ == 0) {
						$("#PercentHome").val(7);
					}
					if (typ == 1) {
						$("#PercentHome").val(9);
					}
				} 
				if (cat == 0) {
					$("#CabBudget").val(40);
					$("#FloorBudget").val(7);
					$("#CounterBudget").val(12);
					$("#AppBudget").val(8);
					$("#LightingBudget").val(4);
					$("#WallBudget").val(3);
					$("#LaborBudget").val(25);
					$("#MiscBudget").val(1);
					// $("#PercentHome").val(12);
					if (typ == 0) {
						$("#PercentHome").val(11);
					}
					if (typ == 1) {
						$("#PercentHome").val(13);
					}
				}
			}

			function TotalCostKitchen() { 

				var roiArr = [42, 39, 40, 42, 60, 47, 59, 59, 52, 52, 61, 54, 49, 50, 39, 36, 40, 75] //2018

				var loc = $("#locSelect").val();
				var cat = $("#catSelect").val();
				var type = $("#typeSelect").val(); 

				console.log(loc + " - " + cat + " - " + type)  

				var roiArr2 = roiArr.slice(loc)
				var roiArr3 = roiArr2.slice(cat)
				var roiArr4 = roiArr3.slice(type)

				var roi = (roiArr4[0] / 100); 

				console.log(roi)

				var TotalBudget = 0

				var homeStr = document.getElementById('HomeValue').value; 
				var valHome = Number(homeStr)
				console.log(valHome)

				var ProjBudget = ((document.getElementById('HomeValue').value)*((document.getElementById('PercentHome').value)/100))
				if (document.getElementById('budget').value > 0) {
					TotalBudget = (document.getElementById('budget').value)
				} else {
					TotalBudget = ProjBudget
					// document.getElementById('budget').value = TotalBudget
				}

				var Cabinet = TotalBudget * (document.getElementById('CabBudget').value / 100)
				var Flooring = TotalBudget * (document.getElementById('FloorBudget').value / 100)
				var Counter = TotalBudget * (document.getElementById('CounterBudget').value / 100)
				var Appliance = TotalBudget * (document.getElementById('AppBudget').value / 100)
				var Lighting = TotalBudget * (document.getElementById('LightingBudget').value / 100)
				var Wall = TotalBudget * (document.getElementById('WallBudget').value / 100)
				var Labor = TotalBudget * (document.getElementById('LaborBudget').value / 100)
				var Misc = TotalBudget * (document.getElementById('MiscBudget').value / 100)

				$("#cabinetCalc").html("$ " + Cabinet.toFixed(2).toLocaleString());
				$("#flooringCalc").html("$ " + Flooring.toFixed(2).toLocaleString());
				$("#counterCalc").html("$ " + Counter.toFixed(2).toLocaleString());
				$("#applCalc").html("$ " + Appliance.toFixed(2).toLocaleString());
				$("#lightCalc").html("$ " + Lighting.toFixed(2).toLocaleString());
				$("#wallCalc").html("$ " + Wall.toFixed(2).toLocaleString());
				$("#laborCalc").html("$ " + Labor.toFixed(2).toLocaleString());
				$("#miscCalc").html("$ " + Misc.toFixed(2).toLocaleString());

				if (valHome != null && valHome != 0 && valHome != NaN) {

					var pleaseWork = $('<th>Total Budget</th><td>$ <input id="budget" type="number" size="5" name="budget" value="' + ProjBudget + '"/></td>')
					$("#theBudget").html(pleaseWork);
					$("#totalCalc").html("<b>$ " + ProjBudget.toFixed(2).toLocaleString() + "</b>")

					var netVal = ProjBudget * roi; 
					var newHome = valHome + netVal; 
					console.log(newHome)
					$("#homeCalc").html("<b>$ " + newHome.toFixed(2).toLocaleString() + "</b>")
				}

				$("#roiCalc").html("<b>$ " + netVal.toFixed(2).toLocaleString() + "</b>")

			}

			function handleTotal() {
				var thisInput = this;
				var validate = [];

				var thisVal = $(thisInput).val()
				console.log(thisVal)

				$(".breakdown").each(function(){
					var num = $(this).val();
					var numb = Number(num)
					validate.push(numb)
				})

				console.log(validate)

				const reducer = (accumulator, currentValue) => accumulator + currentValue;
				var reduced = validate.reduce(reducer);
				console.log(reduced);

				if(reduced > 100) {
					var rem = reduced - 100; 
					console.log(rem);
					var fix = thisVal - rem;
					console.log(thisVal)
					console.log(fix); 
					$(thisInput).val(fix)
				}
				if(reduced <= 100) {
					$("#totalCalc").html(reduced + " %")
				}

			}

			$(document.body).on("click", '.callButtonKitchen', TotalCostKitchen);
			$(document.body).on("click", ".breakdown", handleTotal); 
			$(document.body).on("click", ".dropSelect", handleDrop);

		})

	</script>

</head>
<body>
	<center>
	<div style="margin: 10px; font-size: 30px; color: #758697; width: 75%;">2018 Greater Philadelphia Area Home Improvement ROI Calculator</div>
	<br />
	<div class="optionCont" style="margin: 20px; ">
	 	<select id="locSelect" class="dropSelect" style="height: 40px; color: #fff; padding: 10px; margin: 5px; border-radius: 6px; background-color: #758697">
	 		<option value="0">Allentown, PA</option>
	 		<option value="6">Philadelphia, PA</option>
	 		<option value="12">Trenton, NJ</option>
	 	</select>

	 	<select id="catSelect" class="dropSelect" style="height: 40px; color: #fff; padding: 10px; margin: 5px; border-radius: 6px; background-color: #758697">
	 		<option value="0">Kitchen Remodel</option>
	 		<option value="2">Bathroom Addition</option>
	 		<option value="4">Bathroom Remodel</option>
	 	</select>

	 	<select id="typeSelect" class="dropSelect" style="height: 40px; color: #fff; padding: 10px; margin: 5px; border-radius: 6px; background-color: #758697">
	 		<option value="0">Midrange</option>
	 		<option value="1">Upscale</option>
	 	</select>
	</div>
	
 	<div class="container" style="text-align: middle;">

		<table style="width: 50%; margin: 20px; border: 2px; border-color: #878882; border-style: solid; border-radius: 6px; padding: 10px;">
		  <tr id="theBudget">
		    <th>Total Budget:</th>
		    <td>$ <span><input id="budget" type="number" size="5" name="budget" value="" /></span></td>
		  </tr>
		</table>

		<h2>Or ...</h2>

		<table style="width: 50%; margin: 20px; border: 2px; border-color: #878882; border-style: solid; border-radius: 6px; padding: 10px;">
	    <tr>
	        <td align="center" colspan="2" style="padding-top: 12px; padding-bottom: 12px; background-color: #758697; color: #fff;"><b>Enter your Home's Value</b></td>
	    </tr>
		  <tr>
		    <th>Home Value:</th>
		    <td><p>$ <span><input id="HomeValue" type="number" size="5" name="budget" value=""/></span></p></td>
		  </tr>
		  <tr>
		    <th>% of Home Value:</th>
		    <td><input id="PercentHome" type="number" min="0" max="100" size="5" name="budget" value="12"/><span> %</span></td>
		  </tr>
		</table>

		<table style="width: 75%; margin: 20px; line-height: 30px; border: 2px; border-color: #878882; border-style: solid; border-radius: 6px; padding: 10px;">
		  <tr style="padding-top: 12px; padding-bottom: 12px; background-color: #758697; color: #fff;">
		    <th>Section</th>
		    <th>Project Percentage</th> 
		    <th>Breakdown</th>
		  </tr>
		  <tr style="background-color: #f2f2f2;">
		    <td>Cabinet</td>
		    <td><input style="width: 25%;" id="CabBudget" class="breakdown" type="number" min="0" max="100" size="5" name="budget" value="40"/><span> %</span></td> 
		    <td><div id="cabinetCalc" class="secTotals"></div></td>
		  </tr>
		  <tr>
		    <td>Flooring</td>
		    <td><input style="width: 25%;" id="FloorBudget" class="breakdown" type="number" min="0" max="100" size="5" name="budget" value="7"/><span> %</span></td> 
		    <td id="flooringCalc" class="secTotals"></td>
		  </tr>
		  <tr style="background-color: #f2f2f2;">
		    <td>Counter Tops</td>
		    <td><input style="width: 25%;" id="CounterBudget" class="breakdown" type="number" min="0" max="100" size="5" name="budget" value="12"/><span> %</span></td> 
		    <td id="counterCalc" class="secTotals"></td>
		  </tr>
		  <tr>
		    <td>Appliances</td>
		    <td><input style="width: 25%;" id="AppBudget" class="breakdown" type="number" min="0" max="100" size="5" name="budget" value="8"/><span> %</span></td> 
		    <td id="applCalc" class="secTotals"></td>
		  </tr>
		  <tr style="background-color: #f2f2f2;">
		    <td>Lighting/Electrical</td>
		    <td><input style="width: 25%;" id="LightingBudget" class="breakdown" type="number" min="0" max="100" size="5" name="budget" value="4"/><span> %</span></td> 
		    <td id="lightCalc" class="secTotals"></td>
		  </tr>
		  <tr>
		    <td>Wall Covering</td>
		    <td><input style="width: 25%;" id="WallBudget" class="breakdown" type="number" min="0" max="100" size="5" name="budget" value="3"/><span> %</span></td> 
		    <td id="wallCalc" class="secTotals"></td>
		  </tr>
		  <tr style="background-color: #f2f2f2;">
		    <td>Labor</td>
		    <td><input style="width: 25%;" id="LaborBudget" class="breakdown" type="number" min="0" max="100" size="5" name="budget" value="25"/><span> %</span></td> 
		    <td id="laborCalc" class="secTotals"></td>
		  </tr>
		  <tr>
		    <td>Misc</td>
		    <td><input style="width: 25%;" id="MiscBudget" class="breakdown" type="number" min="0" max="100" size="5" name="budget" value="1"/><span> %</span></td> 
		    <td id="miscCalc" class="secTotals"></td>
		  </tr>
		  <tr style="background-color: #f2f2f2;">
		    <td><b>Total</b></td>
		    <td></td> 
		    <td id="totalCalc"></td>
		  </tr>
		  <tr>
		    <td><b>Projected ROI</b></td>
		    <td></td>
		    <td id="roiCalc"></td> 
		  </tr>
		  <tr>
		    <td style="background-color: #f2f2f2;"><b>Projected Home Value</b></td> 
		    <td></td>
		    <td id="homeCalc"></td>
		  </tr>
		  <tr>
		  	<td><button class="callButtonKitchen" style="margin: 20px;">Calculate</button></td>
		  </tr>
		</table>
		
	</div>
	</center>
</body>
</html>